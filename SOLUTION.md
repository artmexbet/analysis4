# SOLUTION

## Обзор архитектуры
- **process_mining_analysis.py** реализует полный конвейер анализа журнала событий (от загрузки файла до визуализации графа процесса).
- Скрипт работает как CLI-утилита: аргументы парсятся через `argparse`, что позволяет указывать произвольный путь к CSV/XES и включать интерактивный показ графа.
- Код не зависит от симуляционных данных: основной вход — реальные логи в каталоге `input_data/`.

## Конвейер обработки
1. **Парсинг аргументов** (`parse_arguments`)
   - `--source` — путь к журналу событий (по умолчанию `input_data/running_example_broken.csv`).
   - `--show-plot` — отображение графа после генерации.
2. **Загрузка журнала** (`load_event_log`)
   - Поддерживает CSV и XES. Для XES используется `pm4py`; импорт оборачивается в `try/except`, чтобы дать понятную ошибку, если пакет не установлен.
   - CSV читается с `sep=None` и `engine="python"`, что позволяет автоматически распознавать `;`/`,` разделители.
   - Колонки маппятся в унифицированный набор (`case_id`, `activity`, `timestamp`, `resource`, `cost`).
   - Временные метки приводятся к UTC, ресурсы нормализуются, пропущенные значения отбрасываются.
3. **Определение старт/финиш активностей** (`determine_boundary_activities`)
   - Группирует события по кейсам и фиксирует наиболее частые начальные и конечные активности. Эти данные используются при анализе оптимальных путей и окраске узлов на графе.
4. **Предобработка** (`preprocess_data`)
   - Сортировка по `case_id`/`timestamp`.
   - Вывод базовых метрик (кейсы, активности, ресурсы, суммарные/средние затраты).
   - Список уникальных активностей и их частоты.
5. **Построение графа** (`build_process_graph`)
   - Для каждого кейса формируются переходы между последовательными активностями.
   - Граф представлен как `nx.DiGraph`, веса рёбер = количество переходов.
6. **Анализ графа** (`analyze_graph`)
   - Степени узлов для поиска узких мест.
   - Циклы (`nx.simple_cycles`) с выводом всех найденных петель.
   - Выявление вариантов процесса: кейсы группируются по последовательностям активностей, стандартный путь определяется по максимальной частоте.
   - Построение всех простых путей между доминирующими стартом/финишем и поиск кратчайшего пути.
7. **Анализ длительности** (`analyze_duration`)
   - Для каждого кейса рассчитывается длительность (в часах), количество событий и трасса.
   - Статистика (min/max/mean/median) + кейсы выше 75-го перцентиля.
8. **Рекомендации** (`suggest_optimizations`)
   - Формируются на основе выявленного узкого места, циклов, отклонений, длительных кейсов и дорогих кейсов (если есть `cost`).
9. **Визуализация** (`visualize_process`)
   - `networkx` + `matplotlib` с весами рёбер, цветовой код старт/финал/остальное, сохранение в `process_graph.png`.

## Ключевые особенности реализации
- **Автоматическое распознавание формата**: единая точка входа `load_event_log` делает проект пригодным для разных датасетов без переписывания кода.
- **Нормализация временных зон**: `pd.to_datetime(..., utc=True)` исключает ошибки сортировки при международных логах.
- **Гибкий анализ путей**: старт и конец не захардкожены, что важно для журналов с несколькими сценариями завершения (`reject request`, `pay compensation`).
- **Консистентные метрики**: все статистики и рекомендации рассчитываются на реальных данных и автоматически обновляются при смене источника.

## Инструкции по запуску
```bash
pip install -r requirements.txt
python process_mining_analysis.py --source input_data/running_example_broken.csv
```
Опционально можно указать любой другой CSV/XES:
```bash
python process_mining_analysis.py --source path/to/other_log.csv --show-plot
```

## Артефакты
- `process_graph.png` — визуализация процесса с актуальными весами рёбер.
- Консольный лог содержит все промежуточные метрики и рекомендации; при необходимости результаты можно перенаправить в файл.

## Зависимости
- `pandas` — обработка табличных данных и вычисление статистик.
- `networkx` — построение и анализ графа.
- `matplotlib` — визуализация процесса.
- `pm4py` — чтение XES (опционально, требуется только для таких файлов).

